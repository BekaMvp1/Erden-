# Производственная логика

## Жизненный цикл заказа

### 1. Создание заказа

- Менеджер или администратор создаёт заказ через форму.
- Обязательные поля: клиент, название, количество, дедлайн.
- Статус автоматически устанавливается **«Принят»**.
- Заказ создаётся **без распределения** — `floor_id` и `technologist_id` равны `NULL`.

### 2. Распределение заказа

- Выполняется вручную на странице «Распределение».
- Выбираются: этаж, технолог, операции с назначением швей.
- Каждая операция связывается с швеёй, указывается `planned_quantity` и опционально `planned_date`.
- Всё выполняется **в одной транзакции**.
- После успешного распределения статус меняется на **«В работе»**.

### 3. Выполнение

- Швеи видят свои операции в заказах.
- Фактическое количество (`actual_quantity`) вносится через редактирование операции планирования.

### 4. Готовность

- Статус «Готов» и «Просрочен» устанавливаются вручную (в текущей версии через прямые изменения в БД или будущий функционал).

## Ограничения по ролям

| Роль | Доступ |
|------|--------|
| admin | Полный доступ |
| manager | Заказы, распределение, планирование, отчёты |
| technologist | Только свой этаж, свои заказы, свой план |
| operator (швея) | Только просмотр заказов со своими операциями |

## Мощность и загрузка

- У каждой швеи есть `capacity_per_day` (минуты в день, по умолчанию 480 = 8 часов).
- План нагрузки считается как сумма `planned_quantity * norm_minutes` по операциям заказа.
- Перегруз — когда плановая нагрузка превышает мощность.
